<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Apply — MerchantHaus (U.S. Retail ISO)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;800&display=swap" rel="stylesheet" />
  <script src="https://unpkg.com/lucide@latest"></script>
  <style>
    body{font-family:Montserrat,system-ui,sans-serif}
    .field:focus{outline:none;box-shadow:0 0 0 3px rgba(239,60,91,.35)}
  </style>
  <link rel="icon" type="image/x-icon" href="assets/img/logo.ico">
</head>
<body class="bg-white text-slate-900 dark:bg-slate-950 dark:text-slate-100">
  <header class="sticky top-0 z-40 bg-white/75 dark:bg-slate-950/60 backdrop-blur border-b border-slate-200 dark:border-slate-800">
    <div class="max-w-5xl mx-auto px-4 py-4 flex items-center justify-between">
      <a href="/" class="font-extrabold">MerchantHaus</a>
      <nav class="hidden md:flex items-center gap-6 text-sm">
        <a href="/#payments" class="hover:text-brand-600">Payments</a>
        <a href="/#pricing" class="hover:text-brand-600">Pricing</a>
        <a href="/#platforms" class="hover:text-brand-600">Platforms</a>
        <a href="/#faq" class="hover:text-brand-600">FAQ</a>
      </nav>
    </div>
  </header>

  <main class="max-w-5xl mx-auto px-4 py-10">
    <h1 class="text-3xl md:text-4xl font-extrabold">Merchant Application</h1>
    <p class="mt-2 text-slate-600 dark:text-slate-300">U.S. retail only. Provide the details below — we’ll review and issue your Merchant ID (MID) & access credentials during onboarding.</p>

    <form id="apply-form" class="mt-8 grid gap-6">
      <!-- Merchant Information -->
      <section class="p-6 rounded-2xl border border-slate-200 dark:border-slate-800">
        <h2 class="text-xl font-bold">Merchant Information</h2>
        <div class="mt-4 grid md:grid-cols-2 gap-4">
          <label class="text-sm">Company Name*<input name="companyName" class="field mt-1 w-full rounded-lg border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-900 px-3 py-2" required></label>
          <label class="text-sm">External Identifier<input name="externalId" class="field mt-1 w-full rounded-lg border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-900 px-3 py-2"></label>
          <label class="text-sm">Country*<select name="country" class="field mt-1 w-full rounded-lg border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-900 px-3 py-2" required><option>United States</option></select></label>
          <label class="text-sm">Timezone*<select name="timezone" class="field mt-1 w-full rounded-lg border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-900 px-3 py-2" required>
            <option>(GMT-08:00) Pacific Time (US & Canada)</option>
            <option>(GMT-07:00) Mountain Time (US & Canada)</option>
            <option>(GMT-06:00) Central Time (US & Canada)</option>
            <option>(GMT-05:00) Eastern Time (US & Canada)</option>
          </select></label>
          <label class="text-sm md:col-span-2">Address*<input name="address1" class="field mt-1 w-full rounded-lg border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-900 px-3 py-2" required></label>
          <label class="text-sm">Address 2<input name="address2" class="field mt-1 w-full rounded-lg border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-900 px-3 py-2"></label>
          <label class="text-sm">City*<input name="city" class="field mt-1 w-full rounded-lg border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-900 px-3 py-2" required></label>
          <label class="text-sm">State*<select name="state" class="field mt-1 w-full rounded-lg border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-900 px-3 py-2" required></select></label>
          <label class="text-sm">Zip/Postal Code*<input name="postalCode" class="field mt-1 w-full rounded-lg border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-900 px-3 py-2" required></label>
          <label class="text-sm md:col-span-2">Website<input name="website" type="url" placeholder="https://example.com" class="field mt-1 w-full rounded-lg border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-900 px-3 py-2"></label>
          <label class="text-sm">Language<select name="language" class="field mt-1 w-full rounded-lg border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-900 px-3 py-2"><option>English</option></select></label>
        </div>
      </section>

      <!-- Company Contact -->
      <section class="p-6 rounded-2xl border border-slate-200 dark:border-slate-800">
        <h2 class="text-xl font-bold">Company Contact (Primary User)</h2>
        <p class="text-xs text-slate-500 mt-1">This person receives the welcome email and appears on receipts if enabled.</p>
        <div class="mt-4 grid md:grid-cols-2 gap-4">
          <label class="text-sm">First Name*<input name="firstName" class="field mt-1 w-full rounded-lg border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-900 px-3 py-2" required></label>
          <label class="text-sm">Last Name*<input name="lastName" class="field mt-1 w-full rounded-lg border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-900 px-3 py-2" required></label>
          <label class="text-sm">Email Address*<input name="email" type="email" class="field mt-1 w-full rounded-lg border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-900 px-3 py-2" required></label>
          <label class="text-sm">Phone Number*<input name="phone" class="field mt-1 w-full rounded-lg border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-900 px-3 py-2" required></label>
          <label class="text-sm">Fax Number<input name="fax" class="field mt-1 w-full rounded-lg border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-900 px-3 py-2"></label>
        </div>
      </section>

      <!-- Account Setup & Services -->
      <section class="p-6 rounded-2xl border border-slate-200 dark:border-slate-800">
        <h2 class="text-xl font-bold">Account Setup</h2>
        <div class="mt-4 grid md:grid-cols-2 gap-4">
          <label class="text-sm md:col-span-2">Primary Username*<input name="username" minlength="4" maxlength="32" pattern="[A-Za-z0-9]+" placeholder="letters and numbers only" class="field mt-1 w-full rounded-lg border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-900 px-3 py-2" required></label>
        </div>

        <h3 class="mt-4 font-semibold">Processing Services</h3>
        <div class="mt-2 grid md:grid-cols-3 gap-3 text-sm">
          <label class="inline-flex items-center gap-2"><input type="checkbox" name="svcCredit" class="accent-red-600" checked>Credit Card</label>
          <label class="inline-flex items-center gap-2"><input type="checkbox" name="svcAch" class="accent-red-600">ACH / eCheck</label>
          <label class="inline-flex items-center gap-2"><input type="checkbox" name="svcCash" class="accent-red-600">Cash</label>
        </div>

        <h3 class="mt-4 font-semibold">Value‑added Services</h3>
        <div class="mt-2 grid md:grid-cols-3 gap-3 text-sm">
          <label class="inline-flex items-center gap-2"><input type="checkbox" name="valEncryption" class="accent-red-600">Encryption (Encrypted Devices)</label>
          <label class="inline-flex items-center gap-2"><input type="checkbox" name="valInvoice" class="accent-red-600" checked>Invoice</label>
          <label class="inline-flex items-center gap-2"><input type="checkbox" name="valLevel3" class="accent-red-600">Level III Advantage</label>
          <label class="inline-flex items-center gap-2"><input type="checkbox" name="valMobile" class="accent-red-600">Mobile Payments</label>
          <label class="inline-flex items-center gap-2"><input type="checkbox" name="valVault" class="accent-red-600" checked>Customer Vault</label>
        </div>

        <div class="mt-4 text-xs text-slate-600 dark:text-slate-300">
          By submitting, you agree to our <a href="https://merchant.haus/terms" target="_blank" rel="noopener" class="underline">Terms & Conditions</a> and <a href="https://merchant.haus/privacy" target="_blank" rel="noopener" class="underline">Privacy Policy</a>.
        </div>
      </section>

      <div class="flex items-center gap-3">
        <button class="px-5 py-3 rounded-lg bg-brand-600 text-white font-semibold hover:bg-brand-700" type="submit">Submit Application</button>
        <span id="apply-out" class="text-sm text-slate-600 dark:text-slate-300"></span>
      </div>
    </form>
  </main>

  <script>
    // Populate state list (US)
    const states = ["Alabama","Alaska","Arizona","Arkansas","California","Colorado","Connecticut","Delaware","District of Columbia","Florida","Georgia","Hawaii","Idaho","Illinois","Indiana","Iowa","Kansas","Kentucky","Louisiana","Maine","Maryland","Massachusetts","Michigan","Minnesota","Mississippi","Missouri","Montana","Nebraska","Nevada","New Hampshire","New Jersey","New Mexico","New York","North Carolina","North Dakota","Ohio","Oklahoma","Oregon","Pennsylvania","Rhode Island","South Carolina","South Dakota","Tennessee","Texas","Utah","Vermont","Virginia","Washington","West Virginia","Wisconsin","Wyoming"];
    const stateSelect = document.querySelector('select[name="state"]');
    if (stateSelect) { states.forEach(s => { const opt=document.createElement('option'); opt.textContent=opt.value=s; stateSelect.appendChild(opt); }); }

    const form = document.getElementById('apply-form');
    const out = document.getElementById('apply-out');

    // Save draft to localStorage
    const LS_KEY = 'mh_apply_draft';
    function saveDraft(){ const data = Object.fromEntries(new FormData(form).entries()); localStorage.setItem(LS_KEY, JSON.stringify(data)); }
    function loadDraft(){ try { const d = JSON.parse(localStorage.getItem(LS_KEY)||'{}'); for (const k in d){ const el = form.elements[k]; if (!el) continue; if (el.type==='checkbox'){ el.checked = !!d[k]; } else { el.value = d[k]; } } } catch(e){} }
    form.addEventListener('input', saveDraft);
    loadDraft();

    function getUTM(){
      const p = new URLSearchParams(location.search);
      return {source:p.get('utm_source')||'',medium:p.get('utm_medium')||'',campaign:p.get('utm_campaign')||'',term:p.get('utm_term')||'',content:p.get('utm_content')||'',ref:document.referrer||''};
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      out.textContent = 'Submitting…';
      try {
        const data = Object.fromEntries(new FormData(form).entries());
        // Include checkbox booleans
        ['svcCredit','svcAch','svcCash','valEncryption','valInvoice','valLevel3','valMobile','valVault'].forEach(k => { data[k] = !!form.elements[k].checked; });
        data.utm = getUTM();

        const res = await fetch('/.netlify/functions/submit-application', {
          method: 'POST',
          headers: {'Content-Type':'application/json'},
          body: JSON.stringify(data)
        });
        if (!res.ok) throw new Error('Request failed');
        out.textContent = 'Thanks — we emailed you next steps and sent your application to our team.';
        localStorage.removeItem(LS_KEY);
        form.reset();
      } catch (err) {
        console.error(err);
        out.textContent = 'Something went wrong. Please try again or email hello@merchant.haus.';
      }
    });
  </script>
</body>
</html>
